.build-nvimagecodec-docs-script: &build-nvimagecodec-docs-script |
    python3 -m pip install artifacts/nvidia_nvimgcodec_cu11-*.whl
    python3 -m pip install nvidia-sphinx-theme --extra-index-url https://urm.nvidia.com/artifactory/api/pypi/ct-omniverse-pypi-local/simple
    cd docs/doxygen
    doxygen
    cd ../sphinx
    make html
    cd ../..

docs:
    stage: build_docs
    image: gitlab-master.nvidia.com:5005/cuda-hpc-libraries/nvimagecodec/runner-cuda-11.8-x86_64:v15
    tags:
        - docker
    dependencies:
        - build:cuda11.8
    artifacts:
        paths:
            - nvimgcodec-docs.tar.gz
        expire_in: 2 weeks
    when: manual
    script:
        - *build-nvimagecodec-docs-script
        - tar -zcvf nvimgcodec-docs.tar.gz --directory=docs/sphinx/_build/ html/
pages:
    stage: deploy
    image: gitlab-master.nvidia.com:5005/cuda-hpc-libraries/nvimagecodec/runner-cuda-11.8-x86_64:v15
    tags:
        - docker
    dependencies:
        - build:cuda11.8
    artifacts:
        paths:
            - public
        expire_in: 1 week
    when: manual
    script:
        - *build-nvimagecodec-docs-script
        - mkdir .public
        - cp -r docs/sphinx/_build/html/* .public
        - mv .public public
